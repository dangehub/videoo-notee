var a=typeof browser<"u",l=typeof chrome<"u"&&!a,t=a?browser:chrome;var u={async get(e){return t.storage.local.get(e)},async set(e){return t.storage.local.set(e)},async remove(e){return t.storage.local.remove(e)},async clear(){return t.storage.local.clear()}},m={async download(e){return new Promise((n,s)=>{t.downloads.download(e,o=>{t.runtime.lastError?s(new Error(t.runtime.lastError.message)):n(o)})})}},c={async query(e){return t.tabs.query(e)},async create(e){return t.tabs.create(e)},async sendMessage(e,n){return t.tabs.sendMessage(e,n)},async getCurrent(){return t.tabs.getCurrent()}},d={getURL(e){return t.runtime.getURL(e)},sendMessage(e){return t.runtime.sendMessage(e)},onMessage:t.runtime.onMessage,get lastError(){return t.runtime.lastError}},p={async open(e){return t.sidePanel?t.sidePanel.open(e):c.create({url:d.getURL("editor/index.html")})},async setOptions(e){if(t.sidePanel)return t.sidePanel.setOptions(e)}},g={async executeScript(e){return t.scripting.executeScript(e)}};var r={storage:u,downloads:m,tabs:c,runtime:d,sidePanel:p,scripting:g,isFirefox:a,isChrome:l,browserAPI:t};var y=document.getElementById("btn-open-editor"),f=document.getElementById("btn-open-player"),w=document.getElementById("btn-screenshot"),E=document.getElementById("btn-sidebar"),b=document.getElementById("btn-settings"),i=document.getElementById("notes-list");async function v(){await P(),y.addEventListener("click",h),f.addEventListener("click",L),w.addEventListener("click",x),E.addEventListener("click",M),b.addEventListener("click",S)}async function h(){await r.tabs.create({url:r.runtime.getURL("editor/index.html")}),window.close()}async function L(){await r.tabs.create({url:r.runtime.getURL("player/index.html")}),window.close()}async function x(){try{let[e]=await r.tabs.query({active:!0,currentWindow:!0});if(!e){alert("\u65E0\u6CD5\u83B7\u53D6\u5F53\u524D\u6807\u7B7E\u9875");return}let n=await r.tabs.sendMessage(e.id,{type:"CAPTURE_VIDEO_FRAME"});if(n.error){alert(n.error);return}await r.runtime.sendMessage({type:"SAVE_SCREENSHOT",data:{screenshot:n.dataUrl,timestamp:n.timestamp,videoUrl:e.url,videoTitle:e.title}}),alert("\u622A\u56FE\u6210\u529F\uFF01")}catch(e){console.error("\u622A\u56FE\u5931\u8D25:",e),alert("\u622A\u56FE\u5931\u8D25\uFF0C\u8BF7\u786E\u4FDD\u5F53\u524D\u9875\u9762\u6709\u89C6\u9891")}}async function M(){await r.runtime.sendMessage({type:"OPEN_EDITOR",data:{mode:"sidebar"}}),window.close()}function S(){r.tabs.create({url:r.runtime.getURL("editor/index.html#settings")}),window.close()}async function P(){try{let e=await r.runtime.sendMessage({type:"GET_NOTES",data:{}});if(!e||e.length===0){i.innerHTML='<p class="empty-tip">\u6682\u65E0\u7B14\u8BB0</p>';return}let n=e.slice(0,5);i.innerHTML=n.map(s=>`
      <div class="note-item" data-id="${s.id}">
        <div class="note-icon">\u{1F4DD}</div>
        <div class="note-info">
          <div class="note-title">${I(s.title||"\u672A\u547D\u540D\u7B14\u8BB0")}</div>
          <div class="note-meta">${R(s.updatedAt)}</div>
        </div>
      </div>
    `).join(""),i.querySelectorAll(".note-item").forEach(s=>{s.addEventListener("click",()=>{let o=s.dataset.id;r.tabs.create({url:r.runtime.getURL(`editor/index.html?note=${o}`)}),window.close()})})}catch(e){console.error("\u52A0\u8F7D\u7B14\u8BB0\u5931\u8D25:",e)}}function R(e){if(!e)return"";let n=new Date(e),o=new Date-n;return o<6e4?"\u521A\u521A":o<36e5?`${Math.floor(o/6e4)} \u5206\u949F\u524D`:o<864e5?`${Math.floor(o/36e5)} \u5C0F\u65F6\u524D`:n.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function I(e){let n=document.createElement("div");return n.textContent=e,n.innerHTML}v();
